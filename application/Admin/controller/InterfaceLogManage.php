<?php/** * Created by PhpStorm. * User: Baymax * Date: 2018/3/15 * Time: 21:04 */namespace app\Admin\controller;use think\Request;use think\Session;use app\Common\Controller\AuthAdminInterManage;Class InterfaceLogManage extends AuthAdminInterManage{    /**     * @param  uid  array     * 查看用户接口使用信息详细列表接口     */    public function log_list($id){        $all = Request::instance()->post();        $user = model('InterLog');        if(!isset($id)){            return json(array('status' => false, 'msg' => "未指定对应的用户的id"));        }        if(Session::get('user_id')!=$id && !Session::get('admin_id')){            return json(array('status' => false, 'msg' => "你没有权限访问哦！"));        }        if (isset($all['sortName'])){            $name = $all['sortName'];        }else{            $name = 'time';        }        //多个字段模糊查找        $where = [];        if($all['type'] != 0){            $where['type'] = $all['type'];        }        if($all['status'] != 2){            $where['status'] = $all['status'];        }        $starttime_day = date("Y-m-d H:i:s",mktime(0,0,0,date('m'),date('d'),date('Y')));        $endtime_day = date("Y-m-d H:i:s",mktime(0,0,0,date('m'),date('d')+1,date('Y'))-1);        $starttime_week = date("Y-m-d H:i:s",mktime(0, 0 , 0,date("m"),date("d")-date("N")+1,date("Y")));        $endtime_week = date("Y-m-d H:i:s",mktime(23,59,59,date("m"),date("d")-date("N")+7,date("Y")));        $starttime_mon = date("Y-m-d H:i:s",mktime(0, 0 , 0,date("m"),1,date("Y")));        $endtime_mon = date("Y-m-d H:i:s",mktime(23,59,59,date("m")+1 ,0,date("Y")));        $starttime_year = date("Y-m-d H:i:s",mktime(0, 0 , 0,1,1,date("Y")));        $endtime_year = date("Y-m-d H:i:s",mktime(23,59,59,12 ,31,date("Y")));       // return json(date("N"));        //提交时间        switch ($all['submit'])        {            case 0:$all['submit']= ['1970-1-1', '2030-10-1'];break;            case 1:$all['submit']= [$starttime_day, $endtime_day];break;            case 2:$all['submit']= [$starttime_week, $endtime_week];break;            case 3:$all['submit']= [$starttime_mon, $endtime_mon];break;            case 4:$all['submit']= [$starttime_year, $endtime_year];break;        }        //$where['user_id']=array('like','%'.$text.'%');        //过滤字段模糊查找//        $list = $user->whereTime('submit_time', $all['submit'])//            ->whereTime('adopt_time', $all['adopt'])//            ->whereTime('change_time', $all['change'])//            ->where($where)->order($name, $all['sortOrder'])//            ->paginate($all['pageSize'],false,[//            'page' => $all['pageNumber'],//            ]);        $list = $user->where('user_id',$id)            ->whereTime('time', 'between', $all['submit'])            ->where($where)->order($name, $all['sortOrder'])            ->paginate($all['pageSize'],false,[                'page' => $all['pageNumber'],            ]);        return json($list);    }}