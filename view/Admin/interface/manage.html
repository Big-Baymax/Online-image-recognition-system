{extend name="base/tablebase"/}{block name="title"}用户接口管理{/block}{block name="css"}{/block}{block name="table"}<!-- Example Card View --><div class="example-wrap">    <div class="example">        <div id="exampleToolbar">            <form id="filter">            <div class="btn-group hidden-xs">                <button type="button" class="btn btn-outline btn-default" id="add" data-toggle="tooltip" data-animation="false" data-original-title="添加">                    <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>                </button>                <button type="button" class="btn btn-outline btn-default" id="del" data-toggle="tooltip" data-animation="false" data-original-title="删除">                    <i class="glyphicon glyphicon-trash" aria-hidden="true"></i>                </button>                <button type="button" class="btn btn-outline btn-default" id="reset" data-toggle="tooltip" data-animation="false" data-original-title="重置">                    <i class="glyphicon glyphicon-repeat" aria-hidden="true"></i>                </button>                <button type="button" class="btn btn-outline btn-default" id="pass" data-toggle="tooltip" data-animation="false" data-original-title="通过">                    <i class="fa fa-check-square-o" aria-hidden="true"></i>                </button>                <button type="button" class="btn btn-outline btn-default" id="nopass" data-toggle="tooltip" data-animation="false" data-original-title="不通过">                    <i class="fa fa-close" aria-hidden="true"></i>                </button>            </div>                <!--<div class="form-group">-->                    <!--<select class="form-control">-->                        <!--<option>1</option>-->                        <!--<option>2</option>-->                        <!--<option>3</option>-->                        <!--<option>4</option>-->                        <!--<option>5</option>-->                    <!--</select>-->                <!--</div>-->            <div class="btn-group btn-select">                <button type="button" class="btn btn-outline btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    类型 <span class="caret"></span>                </button>                <input type="text" class="hidden" value="0" name="type">                <ul class="dropdown-menu">                    <li class="dropdown-option select" value="0"><a href="#">不限</a></li>                    <li class="dropdown-option" value="1"><a href="#">人脸识别</a></li>                    <li class="dropdown-option" value="2"><a href="#">图像识别</a></li>                    <li class="dropdown-option" value="3"><a href="#">印刷文字识别</a></li>                </ul>            </div>            <div class="btn-group btn-select">                <button type="button" class="btn btn-outline btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    状态 <span class="caret"></span>                </button>                <input type="text" class="hidden" value="0" name="status">                <ul class="dropdown-menu">                    <li class="dropdown-option select" value="0"><a href="#">不限</a></li>                    <li class="dropdown-option" value="1"><a href="#">待审核</a></li>                    <li class="dropdown-option" value="2"><a href="#">通过</a></li>                    <li class="dropdown-option" value="3"><a href="#">未通过</a></li>                </ul>            </div>            <div class="btn-group btn-select">                <button type="button" class="btn btn-outline btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    提交时间 <span class="caret"></span>                </button>                <input type="text" class="hidden" value="0" name="submit">                <ul class="dropdown-menu">                    <li class="dropdown-option select" value="0"><a href="#">不限</a></li>                    <li class="dropdown-option" value="1"><a href="#">今天</a></li>                    <li class="dropdown-option" value="2"><a href="#">一周内</a></li>                    <li class="dropdown-option" value="3"><a href="#">一月内</a></li>                    <li class="dropdown-option" value="4"><a href="#">一年内</a></li>                </ul>            </div>            <div class="btn-group btn-select">                <button type="button" class="btn btn-outline btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    通过时间 <span class="caret"></span>                </button>                <input type="text" class="hidden" value="0" name="adopt">                <ul class="dropdown-menu">                    <li class="dropdown-option select" value="0"><a href="#">不限</a></li>                    <li class="dropdown-option" value="1"><a href="#">今天</a></li>                    <li class="dropdown-option" value="2"><a href="#">一周内</a></li>                    <li class="dropdown-option" value="3"><a href="#">一月内</a></li>                    <li class="dropdown-option" value="4"><a href="#">一年内</a></li>                </ul>            </div>            <div class="btn-group btn-select">                <button type="button" class="btn btn-outline btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                    更新时间 <span class="caret"></span>                </button>                <input type="text" class="hidden" value="0" name="change">                <ul class="dropdown-menu">                    <li class="dropdown-option select" value="0"><a href="#">不限</a></li>                    <li class="dropdown-option" value="1"><a href="#">今天</a></li>                    <li class="dropdown-option" value="2"><a href="#">一周内</a></li>                    <li class="dropdown-option" value="3"><a href="#">一月内</a></li>                    <li class="dropdown-option" value="4"><a href="#">一年内</a></li>                </ul>            </div>            </form>        </div>        <table id="table" data-toggle="table" data-card-view="true" data-mobile-responsive="true" data-click-to-select="true" data-unique-id="uid" data-show-export="true">            <thead>            <tr>                <th data-field="state" data-checkbox="true"></th>                <th data-field="uid">UID</th>                <th data-field="user_id" data-sortable="true">用户ID</th>                <th data-field="key">Key</th>                <th data-field="type" data-formatter="typeFormatter" data-sortable="true">类型</th>                <th data-field="status" data-formatter="statusFormatter" data-align="center" data-halign="center" data-sortable="true">状态</th>                <th data-field="submit_time" data-sortable="true">提交时间</th>                <th data-field="adopt_time" data-formatter="timeFormatter" data-sortable="true">审核时间</th>                <th data-field="change_time"data-sortable="true">更新时间</th>                <th data-formatter="showlistFormatter" data-align="center" data-halign="center">使用记录</th>            </tr>            </thead>        </table>    </div></div><!-- End Example Card View -->{/block}{block name="model"}<div class="modal fade add-model" tabindex="-1" role="dialog">    <div class="modal-dialog" role="document">        <div class="modal-content">            <div class="modal-header">                <button type="button" class="close" data-dismiss="modal" aria-label="Close">                    <span aria-hidden="true">&times;</span>                </button>                <h4 class="modal-title">添加</h4>            </div>            <div class="modal-body">                <form method="post" id="add-form">                    <div class="form-group">                        <label>用户选择</label>                        <select class="form-control" id="B-user_id" name="user_id">                            <option value="0">全部</option>                            {volist name="list" id="data" empty="暂时没有数据"}                            <option value="{$data.uid}">{$data.name}({$data.email})</option>                            {/volist}                        </select>                    </div>                    <div class="form-group">                        <label>接口类别：</label>                        <div class="form-control">                            <label class="checkbox-inline">                                <input type="checkbox" id="face" value="1" name="type[]"> 人脸识别                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" id="img" value="2" name="type[]"> 图像识别                            </label>                            <label class="checkbox-inline">                                <input type="checkbox" id="text" value="3" name="type[]"> 印刷文字识别                            </label>                        </div>                    </div>                </form>            </div>            <div class="modal-footer">                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>                <button id="add-confirm" type="button" class="btn btn-primary">确定</button>            </div>        </div>    </div></div>{/block}{block name="linkjs"}{/block}{block name="js"}<script>    $('#table').bootstrapTable({        pagination: true,        url: '_URL_/admin/interface/interface_list',        showToggle: true,        showColumns: true,        method: 'post',        pageSize: 10,        pageNumber: 1,//开始的时候是第几页        pageList: [5, 10, 15, 25,'ALL'],        queryParamsType: '',        sidePagination: "server",        dataField:'data',//指定        // 自定义搜索参数        queryParams: formfilter,        exportTypes: ['json', 'xml', 'csv', 'txt', 'sql', 'excel'],        exportOptions: {fileName: '导出'},        toolbar: "#exampleToolbar",        iconSize: "outline",        sortOrder:"desc",        icons: {            toggle: "glyphicon-list-alt",            columns: "glyphicon-list",            export: 'glyphicon glyphicon-export'        }    });    function statusFormatter(value, row, index) {        if (value == 1) {            return '<a class="label label-success pass" href="#" data_id="'+row.uid+'">待审核</a>'        } else if(value == 2) {            return '<a class="label label-primary pass" href="#"  data_id="'+row.uid+'">通过</a>'        }else{            return '<a class="label label-danger pass" href="#"  data_id="'+row.uid+'">未通过</a>'        }    }    function timeFormatter(value, row, index) {        if (value == '1970-01-01 00:00:00') {            return ''        }else {            return value;        }    }    function typeFormatter(value, row, index) {        if (value == 1) {            return '人脸识别'        } else if(value == 2) {            return '图像识别'        }else if(value == 3){            return '印刷文字识别'        }    }    function showlistFormatter(value, row, index) {        return '<a class="" href="log/' + row.user_id + '">查看该用户使用记录</a>'    }    //修改上传参数    function formfilter(params) {        var val = $("#filter").serializeArray();        for(var key in val){            params[val[key]['name']] = val[key]['value'];        }        return params;    }    $(document).ready(function () {        // Tooltip        $('[data-toggle="tooltip"]').tooltip({            trigger: 'hover'        });        //bootstrap下拉框选择结束事件        $('.btn-select').on('hidden.bs.dropdown', function () {            $(this).children('input').val($(this).children('ul').children('li.select').attr("value"));            $('#table').bootstrapTable('selectPage',1);        });        //下拉选择事件        $('.dropdown-option').click(function () {            $(this).addClass('select');            $(this).siblings('.dropdown-option').removeClass('select');        });        $("#add").click(function () {            $('.add-model').modal('toggle');        })        //添加        $("#add-confirm").click(function () {            if($('#add-form').validate().form()){                $.ajax({                    url: 'add',                    type: 'POST',                    data: $('#add-form').serialize(),                    success: function (result) {                        if (result.status) {                            //status为1成功                            layer.msg('' + result.msg, {icon: 1});                            $('#table').bootstrapTable('refresh');                            $('.add-model').modal('toggle');                            $('#add-form input').val("");                        } else {                            layer.msg('' + result.msg, {icon: 2});                        }                    },                    error:function () {                        layer.msg('网络开小差了!', {icon: 5});                    }                });            }        })        //通过        $("#pass").click(function () {            var id_arr = get_id_arr($('#table'));            //判断是否有数据            if (id_arr) {                //询问框                layer.confirm('确定通过UID为【' + id_arr.join('，') + '】的接口吗？', {                    btn: ['确定', '取消'],//按钮                    skin: 'layui-layer-molv' //样式类名                }, function () {                    //请求后台                    $.ajax({                        url: 'adopt',                        type: 'POST',                        data: {                            uid:id_arr                        },                        success: function (result) {                            if (result.status) {                                //status为1成功                                layer.msg('' + result.msg, {icon: 1});                                $('#table').bootstrapTable('refresh');                            } else {                                layer.msg('' + result.msg, {icon: 2});                            }                        },                        error:function () {                            layer.msg('网络开小差了!', {icon: 5});                        }                    });                });            }        })        //不通过        $("#nopass").click(function () {            var id_arr = get_id_arr($('#table'));            //判断是否有数据            if (id_arr) {                //询问框                layer.confirm('确定通过UID为【' + id_arr.join('，') + '】的接口吗？', {                    btn: ['确定', '取消'],//按钮                    skin: 'layui-layer-molv' //样式类名                }, function () {                    //请求后台                    $.ajax({                        url: 'no_adopt',                        type: 'POST',                        data: {                            uid:id_arr                        },                        success: function (result) {                            if (result.status) {                                //status为1成功                                layer.msg('' + result.msg, {icon: 1});                                $('#table').bootstrapTable('refresh');                            } else {                                layer.msg('' + result.msg, {icon: 2});                            }                        },                        error:function () {                            layer.msg('网络开小差了!', {icon: 5});                        }                    });                });            }        })        //单击禁用操做        $('#table').on('click','.pass',function (event) {            $('#table').bootstrapTable('uncheckAll');            var id_arr = [];            id_arr.push($(this).attr('data_id'));            //请求后台            $.ajax({                url: 'adopt',                type: 'POST',                data: {                    uid:id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('' + result.msg, {icon: 1});                        $('#table').bootstrapTable('refresh');                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                },                error:function () {                    layer.msg('网络开小差了!', {icon: 5});                }            });            //防止冒泡            return false;        })        //删除操做        $("#del").click(function () {            var id_arr = get_id_arr($('#table'));            //判断是否有数据            if (id_arr) {                //询问框                layer.confirm('确定删除UID为【' + id_arr.join('，') + '】的行吗？', {                    btn: ['确定', '取消'],//按钮                    skin: 'layui-layer-molv' //样式类名                }, function () {                    //请求后台                    $.ajax({                        url: 'del',                        type: 'POST',                        data: {                            uid:id_arr                        },                        success: function (result) {                            if (result.status) {                                //status为1成功                                layer.msg('' + result.msg, {icon: 1});                                var data_id = $('#table').bootstrapTable('getSelections');                                //$('#table').bootstrapTable('removeAll');                                if (data_id.length) {                                    for (var i = 0; i < data_id.length; i++) {                                        $('#table').bootstrapTable('removeByUniqueId', data_id[i].uid);                                    }                                }                            } else {                                layer.msg('' + result.msg, {icon: 2});                            }                        },                        error:function () {                            layer.msg('网络开小差了!', {icon: 5});                        }                    });                });            }        });        //重置        $("#reset").click(function () {            var id_arr = get_id_arr($('#table'));            //判断是否有数据            if (id_arr) {                //询问框                layer.confirm('确定重置UID为【' + id_arr.join('，') + '】的用户的密码吗？', {                    btn: ['确定', '取消'],//按钮                    skin: 'layui-layer-molv' //样式类名                }, function () {                    //请求后台                    $.ajax({                        url: 'reset',                        type: 'POST',                        data: {                            uid:id_arr                        },                        success: function (result) {                            if (result.status) {                                //status为1成功                                layer.msg('' + result.msg, {icon: 1});                                $('#table').bootstrapTable('refresh');                            } else {                                layer.msg('' + result.msg, {icon: 2});                            }                        },                        error:function () {                            layer.msg('网络开小差了!', {icon: 5});                        }                    });                });            }        })        //user_operate($('#table'),'user/add','user/del','user/edit/','user/reset','user/defriend');    });</script>{/block}