{extend name="base/tablebase"/}{block name="title"}数据库备份还原{/block}{block name="table"}<div class="panel blank-panel">    <div class="panel-heading">        <div class="panel-options">            <ul class="nav nav-tabs">                <li class="active">                    <a data-toggle="tab" href="#tab-backup" aria-expanded="true">                        <i class="fa fa-database"></i><span class="hidden-xs">备份管理</span>                    </a>                </li>                <li class="">                    <a data-toggle="tab" href="#tab-reset" aria-expanded="false">                        <i class="fa fa-refresh"></i><span class="hidden-xs">还原管理</span>                    </a>                </li>            </ul>        </div>    </div>    <div class="panel-body">        <div class="tab-content">            <div id="tab-backup" class="tab-pane active">                <!-- Example Card View -->                <div class="example-wrap">                    <div class="example">                        <div class="btn-group hidden-xs" id="exampleToolbar" role="group">                            <button type="button" class="btn btn-outline btn-default backup">                                备份                            </button>                            <button type="button" class="btn btn-outline btn-default optimize">                                优化                            </button>                            <button type="button" class="btn btn-outline btn-default repair">                                修复                            </button>                        </div>                        <table id="table" data-toggle="table" data-card-view="true" data-mobile-responsive="true" data-unique-id="uid" data-show-export="true">                            <thead>                            <tr>                                <th data-field="state" data-checkbox="true"></th>                                <th data-field="index" data-sortable="true">ID</th>                                <th data-field="uid" data-sortable="true">表名</th>                                <th data-field="TABLE_ROWS" data-sortable="true">数据量</th>                                <th data-field="DATA_LENGTH" data-sortable="true">数据大小</th>                                <th data-field="CREATE_TIME" data-sortable="true">创建时间</th>                                <th data-field="UPDATE_TIME" data-sortable="true">更新时间</th>                                <th data-field="ENGINE" data-sortable="true">引擎</th>                            </tr>                            </thead>                            {volist name="list" id="data" empty="暂时没有数据"}                            <tr>                                <td></td>                                <td>{$i}</td>                                <td>{$data.TABLE_NAME}</td>                                <td>{$data.TABLE_ROWS}</td>                                <td>{$data.DATA_LENGTH}</td>                                <td>{$data.CREATE_TIME}</td>                                <td>{$data.UPDATE_TIME}</td>                                <td>{$data.ENGINE}</td>                            </tr>                            {/volist}                        </table>                    </div>                </div>                <!-- End Example Card View -->            </div>            <div id="tab-reset" class="tab-pane">                <!-- Example Card View -->                <div class="example-wrap">                    <div class="example">                        <div class="btn-group hidden-xs" id="exampleToolbar2" role="group">                            <button type="button" class="btn btn-outline btn-default reset">                                还原                            </button>                            <button type="button" class="btn btn-outline btn-default del">                                删除                            </button>                            <button type="button" class="btn btn-outline btn-default download">                                下载                            </button>                        </div>                        <table id="table2" data-toggle="table" data-card-view="true" data-mobile-responsive="true" data-unique-id="uid" data-show-export="true">                            <thead>                            <tr>                                <th data-field="state" data-checkbox="true"></th>                                <th data-field="uid" data-sortable="true">UID</th>                                <th data-field="table_name" data-sortable="true">表名</th>                                <th data-field="file_name" data-sortable="true">备份文件</th>                                <th data-field="backup_time" data-sortable="true">备份时间</th>                                <th data-field="download_count" data-sortable="true">下载次数</th>                                <th data-field="reset_time" data-sortable="true">还原时间</th>                                <th data-field="reset_count" data-sortable="true">还原次数</th>                            </tr>                            </thead>                            {volist name="backup_list" id="data" empty="暂时没有数据"}                            <tr>                                <td></td>                                <td>{$data.uid}</td>                                <td>{$data.table_name}</td>                                <td>{$data.file_name}</td>                                <td>{$data.backup_time}</td>                                <td>{$data.download_count}</td>                                <td>{$data.reset_time}</td>                                <td>{$data.reset_count}</td>                            </tr>                            {/volist}                        </table>                    </div>                </div>                <!-- End Example Card View -->            </div>        </div>    </div></div>{/block}{block name="model"}{/block}{block name="linkjs"}{/block}{block name="js"}<script>    $('#table').bootstrapTable({        pagination: true,        showToggle: true,        showColumns: true,        pageSize: 10,        pageNumber:1,//开始的时候是第几页        pageList:[5,10, 15 ,25, 'All'] ,        toolbar: "#exampleToolbar",        iconSize: "outline",        icons: {            toggle: "glyphicon-list-alt",            columns: "glyphicon-list",            export: 'glyphicon glyphicon-export'        }    });    $('#table2').bootstrapTable({        pagination: true,        showToggle: true,        showColumns: true,        pageSize: 10,        pageNumber:1,//开始的时候是第几页        pageList:[5,10, 15 ,25, 'All'],        toolbar: "#exampleToolbar2",        iconSize: "outline",        icons: {            toggle: "glyphicon-list-alt",            columns: "glyphicon-list",            export: 'glyphicon glyphicon-export'        }    });    //获取表格数据    function get_id_arr(table) {        var data_id = table.bootstrapTable('getSelections');        var id_arr = [];        if (data_id.length) {            for (var i = 0; i < data_id.length; i++) {                id_arr.push(data_id[i].uid);            }            return id_arr;        } else {            layer.msg('需要先选择数据行哦！', {icon: 0});        }    }    //备份数据库对应的表    $(".backup").click(function () {        var id_arr = get_id_arr($('#table'));        if (id_arr) {            //请求后台            $.ajax({                url: 'tables/backup',                type: 'POST',                data: {                    table_name: id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('' + result.msg, {                            icon: 1, time: 3000, end: function () {                                location.reload(location.href);                            }                        });                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                }            });        }    })    //优化数据库对应的表    $(".optimize").click(function () {        var id_arr = get_id_arr($('#table'));        if (id_arr) {            //请求后台            $.ajax({                url: 'tables/optimize',                type: 'POST',                data: {                    table_name: id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('' + result.msg, {                            icon: 1, time: 3000, end: function () {                                location.reload(location.href);                            }                        });                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                }            });        }    })    //修复数据库对应的表    $(".repair").click(function () {        var id_arr = get_id_arr($('#table'));        if (id_arr) {            //请求后台            $.ajax({                url: 'tables/repair',                type: 'POST',                data: {                    table_name: id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('' + result.msg, {                            icon: 1, time: 3000, end: function () {                                location.reload(location.href);                            }                        });                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                }            });        }    })    // 还原备份记录    $(".reset").click(function () {        var id_arr = get_id_arr($('#table2'));        if (id_arr) {            //请求后台            $.ajax({                url: 'tables/reset',                type: 'POST',                data: {                    uid: id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('' + result.msg, {                            icon: 1, time: 3000, end: function () {                                location.reload(location.href);                            }                        });                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                }            });        }    })    //删除备份文件    $(".del").click(function () {        var id_arr = get_id_arr($('#table2'));        if (id_arr) {            //请求后台            $.ajax({                url: 'tables/del',                type: 'POST',                data: {                    uid: id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('' + result.msg, {                            icon: 1, time: 3000, end: function () {                                var data_id = $('#table2').bootstrapTable('getSelections');                                if (data_id.length) {                                    for (var i = 0; i < data_id.length; i++) {                                        $('#table2').bootstrapTable('removeByUniqueId', data_id[i].uid);                                    }                                }                            }                        });                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                }            });        }    })    //打包下载备份文件    $(".download").click(function () {        var id_arr = get_id_arr($('#table2'));        if (id_arr) {            //请求后台            $.ajax({                url: 'tables/download',                type: 'POST',                data: {                    uid: id_arr                },                success: function (result) {                    if (result.status) {                        //status为1成功                        layer.msg('正在打包，即将下载！', {                            icon: 1, time: 3000, end: function () {                                window.parent.frames.location.href = "tables/download/file/"+result.msg;                            }                        });                    } else {                        layer.msg('' + result.msg, {icon: 2});                    }                },                error: function () {                    layer.msg('请求失败', {icon: 2});                }            });        }    })    </script>{/block}