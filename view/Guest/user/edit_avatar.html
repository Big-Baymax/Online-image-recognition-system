{extend name="guest@base/user"/}{block name="title"}头像编辑{/block}{block name="navbar-one"}<li class="active"><a href="_ROOT_/user/index">个人中心</a></li>{/block}{block name="contont"}<!-- Begin page content --><div class="container">  <div class="row" style="padding-top:20px ">    <div class="col-md-8 col-xs-12 img-container">        <!--跨域添加crossorigin="anonymous"属性-->        <img id="image" crossorigin="anonymous" src="_IMG_/avatar/{$avatar}" style="max-width: 100%;">    </div>      <div class="col-md-4">          <!-- <h3>Preview:</h3> -->          <div class="preview">              <div class="img-preview preview-lg"></div>              <div class="img-preview preview-md"></div>              <div class="img-preview preview-sm"></div>              <div class="img-preview preview-xs"></div>          </div>      </div>    </div>    <div class="col-md-3 col-xs-12 avatar-edit">            <div class="btn-group">                <label class="btn btn-orange btn-upload" for="inputImage" title="选择图片" data-toggle="tooltip" data-animation="false" data-original-title="选择图片">                    <input type="file" class="sr-only" id="inputImage" name="file" accept=".jpg,.jpeg,.png,.gif,.bmp,.tiff">                    <span class="fa icon-menu fa-upload"></span>                    本地图片                </label>                <button class="btn btn-orange" type="button" data-toggle="tooltip" data-placement="top" title="上传提交" id="upbtn">                    <i class="fa icon-menu fa-check"></i>                    提交                </button>            </div>        <div class="btn-group">            <button class="btn btn-orange" type="button" data-toggle="tooltip" data-placement="top" title="水平翻转" id="hbtn">                <i class="fa icon-menu fa-arrows-h"></i>            </button>            <button class="btn btn-orange" type="button" data-toggle="tooltip" data-placement="top" title="竖直翻转" id="vbtn">                <i class="fa icon-menu fa-arrows-v"></i>            </button>        </div>    </div>    <div class="col-md-6 col-xs-12 avatar-edit">            <div class="btn-group">                <button class="btn btn-orange" type="button" data-toggle="tooltip" data-placement="top" title="放大" id="zpbtn"><i class="fa icon-menu fa-search-plus"></i></button>                <button class="btn btn-orange" type="button" data-toggle="tooltip" data-placement="top" title="缩小" id="zmbtn"><i class="fa icon-menu fa-search-minus"></i></button>            </div>            <div class="btn-group">                <button class="btn btn-orange" type="button" aria-pressed="false" data-toggle="tooltip" data-placement="top" title="左旋转" id="rlbtn"><i class="fa icon-menu fa-rotate-left"></i></button>                <button class="btn btn-orange" type="button" aria-pressed="false" data-toggle="tooltip" data-placement="top" title="右旋转" id="rrbtn"><i class="fa icon-menu fa-rotate-right"></i></button>            </div>        <div class="btn-group">            <button type="button" class="btn btn-orange" title="左移" data-toggle="tooltip" data-animation="false" title="" data-original-title="左移" id="albtn">                <span class="fa icon-menu fa-arrow-left"></span>            </button>            <button type="button" class="btn btn-orange" title="右移" data-toggle="tooltip" data-animation="false" title="" data-original-title="右移" id="arbtn">                <span class="fa icon-menu fa-arrow-right"></span>            </button>            <button type="button" class="btn btn-orange" title="上移" data-toggle="tooltip" data-animation="false" title="" data-original-title="上移" id="apbtn">                <span class="fa icon-menu fa-arrow-up"></span>            </button>            <button type="button" class="btn btn-orange" title="下移" data-toggle="tooltip" data-animation="false" title="" data-original-title="下移" id="adbtn">                <span class="fa icon-menu fa-arrow-down"></span>            </button>        </div>    </div></div>{/block}{block name="linkjs"}<link href="_CSS_/plugins/cropper/cropper.min.css" rel="stylesheet"><script src="_JS_/plugins/cropper/cropper.min.js"></script>{/block}{block name="js"}<script>    $(function () {        var URL = window.URL || window.webkitURL;        var $image = $('#image');        var uploadedImageType = 'image/jpeg';        var uploadedImageURL;    // Tooltip    $('[data-toggle="tooltip"]').tooltip({        trigger: 'hover'    });    var options = {        minContainerHeight :  0,        minContainerWidth : 0,        maxContainerHeight :  0,        maxContainerWidth : 0,        preview: '.img-preview',        aspectRatio:  1/1,//裁剪框比例 1：1        viewMode : 1,//显示        guides :true,//裁剪框虚线 默认true有        dragMode : "move",        checkImageOrigin:true,        build: function (e) { //加载开始            //可以放你的过渡 效果        },        crop: function (e) {        },        background : true,// 容器是否显示网格背景        movable : true,//是否能移动图片        cropBoxMovable :true,//是否允许拖动裁剪框        cropBoxResizable :true,//是否允许拖动 改变裁剪框大小    };    var cropper = $('#image').cropper(options);    //获取文件路径方法兼容    function getObjectURL(file) {        var url = null ;        if (window.createObjectURL!=undefined) { // basic            url = window.createObjectURL(file) ;        } else if (window.URL!=undefined) { // mozilla(firefox)            url = window.URL.createObjectURL(file) ;        } else if (window.webkitURL!=undefined) { // webkit or chrome            url = window.webkitURL.createObjectURL(file) ;        }        return url ;    }        // 打开本地图片        var $inputImage = $('#inputImage');        if (URL) {            $inputImage.change(function () {                var files = this.files;                var file;                if (!$image.data('cropper')) {                    return;                }                if (files && files.length) {                    file = files[0];                    if (/^image\/\w+$/.test(file.type)) {                        uploadedImageType = file.type;                        if (uploadedImageURL) {                            URL.revokeObjectURL(uploadedImageURL);                        }                        uploadedImageURL = URL.createObjectURL(file);                        $image.cropper('destroy').attr('src', uploadedImageURL).cropper(options);                        $inputImage.val('');                    } else {                        window.alert('请选择图片文件！');                    }                }            });        } else {            $inputImage.prop('disabled', true).parent().addClass('disabled');        }    //水平反转    $('#hbtn').click(function () {        var info = $('#image').cropper("getImageData");        if(info.scaleX == 1){            $('#image').cropper("scaleX", -1);        }else{            $('#image').cropper("scaleX", 1);        }    });    //竖直反转    $("#vbtn").click(function () {        var info = $('#image').cropper("getImageData");        if(info.scaleY == 1){            $('#image').cropper("scaleY", -1);        }else{            $('#image').cropper("scaleY", 1);        }    })    //左旋转    $("#rlbtn").click(function () {        $('#image').cropper("rotate", -15);    })    //右旋转    $("#rrbtn").click(function () {        $('#image').cropper("rotate", 15);    })    //缩小    $("#zmbtn").click(function () {        $('#image').cropper("zoom", -0.1)    })    //放大    $("#zpbtn").click(function () {        $('#image').cropper("zoom", 0.1)    })    //上移    $("#apbtn").click(function () {        $('#image').cropper("move", 0, -10);    })    //下移    $("#adbtn").click(function () {        $('#image').cropper("move", 0, 10);    })    //左移    $("#albtn").click(function () {        $('#image').cropper("move", -10, 0);    })    //右移    $("#arbtn").click(function () {        $('#image').cropper("move", 10, 0);    })    $("#upbtn").click(function () {        var data = $('#image').cropper("getCanvasData")        //console.log($('#image').cropper("getCroppedCanvas",data).toDataURL('image/jpg'));        $.ajax({            url: 'upload',            type: 'POST',            data: {                avatar:$('#image').cropper("getCroppedCanvas",data).toDataURL('image/jpg')            },            success: function (result) {                if (result.status) {                    //status为1成功                    layer.msg('' + result.msg, {                        icon: 1,                        time:3000,                        end:function(){                            parent.location.href=parent.location.href;                        }                    });                } else {                    layer.msg('' + result.msg, {icon: 2});                }            },            error:function () {                layer.msg('网络开小差了!', {icon: 5});            }        });    })    })</script>{/block}